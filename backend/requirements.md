# 项目需求文档

## 1. 项目概述

这是一个前后端分离的代码仓库管理系统,主要功能包括代码仓库管理、文件处理以及AI辅助分析等功能。

### 1.1 技术栈
- 后端框架: FastAPI
- 数据库: MongoDB
- 前端: React (前端部分由其他团队成员负责)

## 2. 核心功能需求

### 2.1 用户系统
- 用户注册与登录
- 用户信息管理
- 多用户协作支持

### 2.2 代码仓库管理
- 创建/删除代码仓库
- 仓库权限管理(所有者和协作者)
- 文件上传与管理
- 仓库信息预览

### 2.3 文件处理系统
- 支持文件上传和存储
- 文件结构化处理
  - 源文件到结构化文件的转换
  - 支持Excel和JSON格式输出
- 文件预览功能
- 临时文件清理机制

### 2.4 AI对话系统
- 基于仓库内容的智能对话
- 聊天历史记录存储
- 聊天记录查询与管理

## 3. 数据模型

### 3.1 用户(User)
- 用户ID
- 用户名
- 密码(加密存储)
- 关联仓库列表
- 聊天历史ID列表
- 创建时间

### 3.2 代码仓库(Repository)
- 仓库ID
- 仓库名称
- 所有者ID
- 协作者ID列表
- 文件ID列表
- 结构化文件ID列表
- 创建时间
- 更新时间

### 3.3 文件(File)
- 文件ID
- 文件名
- 文件内容
- 创建时间
- 更新时间

### 3.4 结构化文件(StructureFile)
- 结构化文件ID
- Excel内容
- JSON内容
- 创建时间

### 3.5 聊天历史(ChatHistory)
- 聊天历史ID
- 消息列表
  - 发送者
  - 消息内容
  - 时间戳

## 4. API接口设计

### 4.1 仓库相关
```python
POST /repos/upload              # 上传文件到仓库
GET /users/{user_id}/repos      # 获取用户的仓库列表
GET /repos/{repo_id}/files      # 获取仓库中的文件列表
```

### 4.2 聊天相关
```python
POST /chat                          # 发送聊天消息
GET /users/{user_id}/chat-history   # 获取用户的聊天历史列表
GET /chat-history/{history_id}      # 获取特定聊天历史的消息
```

## 5. 开发规范

### 5.1 Git规范
- 禁止直接在main/master分支修改
- 每个开发者在自己的分支进行开发
- 合并前必须先拉取最新代码并解决冲突
- 确保代码质量后再合并到主分支

### 5.2 代码规范
- 使用Python类型提示
- 所有函数必须包含文档字符串
- 使用异步函数处理I/O操作
- 统一使用驼峰命名法

## 6. 项目分工
- 数据库设计和API设计: 1人
- API实现: 1人
- 聊天系统和代码集成: 1人

## 7. 后续规划
- 完善错误处理机制
- 添加单元测试
- 优化文件处理性能
- 增强AI对话功能 