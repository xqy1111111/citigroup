# Backend 2.0

这是项目的重构版本，采用更清晰的分层架构。

## 目录结构
```
backend_2/
├── __init__.py
├── main.py                 # 应用入口点
├── config/                 # 配置相关
│   ├── __init__.py
│   └── settings.py        # 配置设置
├── api/                    # API路由层
│   ├── __init__.py
│   ├── endpoints/         # API端点
│   │   ├── __init__.py
│   │   ├── users.py      # 用户相关路由
│   │   ├── repos.py      # 仓库相关路由
│   │   ├── files.py      # 文件相关路由
│   │   └── chat.py       # 聊天相关路由
│   └── dependencies.py    # 共享依赖项(认证等)
├── core/                  # 核心功能
│   ├── __init__.py
│   ├── security.py       # 安全相关(认证、权限)
│   └── errors.py         # 错误处理
├── models/               # 数据模型
│   ├── __init__.py
│   ├── user.py          # 用户模型
│   ├── repo.py          # 仓库模型
│   ├── file.py          # 文件模型
│   └── chat.py          # 聊天模型
├── services/            # 业务逻辑层
│   ├── __init__.py
│   ├── user_service.py  # 用户相关业务逻辑
│   ├── repo_service.py  # 仓库相关业务逻辑
│   ├── file_service.py  # 文件处理业务逻辑
│   └── chat_service.py  # 聊天相关业务逻辑
├── db/                  # 数据库相关
│   ├── __init__.py
│   ├── database.py     # 数据库连接
│   └── repositories/   # 数据访问层
│       ├── __init__.py
│       ├── base.py     # 基础仓库类
│       ├── user.py     # 用户数据访问
│       ├── repo.py     # 仓库数据访问
│       ├── file.py     # 文件数据访问
│       └── chat.py     # 聊天数据访问
├── utils/              # 工具函数
│   ├── __init__.py
│   └── helpers.py     # 通用辅助函数
└── DataStructuring/   # 文件处理模块
    └── DataStructuring/
        ├── main.py    # 文件处理主逻辑
        ├── SourceData/ # 源文件目录
        └── TargetData/ # 处理后文件目录
```

## 重构说明

1. 将原有的models.py拆分为独立的模型文件
2. 将routers.py拆分为不同的路由端点文件
3. 添加服务层处理业务逻辑
4. 添加数据访问层处理数据库操作
5. 保留原有的DataStructuring模块
6. 添加配置管理和错误处理

## 迁移步骤

1. 创建新的目录结构
2. 迁移现有模型到models/目录
3. 迁移路由到api/endpoints/目录
4. 实现服务层和数据访问层
5. 配置数据库连接
6. 迁移文件处理逻辑
7. 添加认证和错误处理 

## 分层架构详解

### 1. 表现层 (API层)
位置: `/api/endpoints/`
- 处理HTTP请求和响应
- 参数验证和请求格式化
- 调用服务层处理业务逻辑
- 错误处理和响应封装
- 不包含业务逻辑，只负责协调和转发

### 2. 业务逻辑层 (Service层)
位置: `/services/`
- 实现核心业务逻辑和规则
- 事务管理和数据一致性控制
- 调用数据访问层处理数据
- 处理跨领域业务流程
- 实现业务验证和约束
- 协调多个Repository的操作

### 3. 数据访问层 (Repository层)
位置: `/db/repositories/`
- 封装所有数据库操作
- 实现CRUD基础操作
- 处理数据持久化
- 提供数据查询接口
- 数据映射和转换
- 不包含业务逻辑

### 4. 领域模型层 (Model层)
位置: `/models/`
- 定义数据结构和关系
- 实现数据验证规则
- 封装领域对象行为
- 处理数据序列化
- 定义模型间关系

### 5. 基础设施层
位置: `/core/`, `/utils/`, `/config/`
- 提供技术支持功能
- 实现横切关注点
- 包含：
  - 认证授权
  - 日志记录
  - 配置管理
  - 错误处理
  - 通用工具
  - 中间件

### 数据流向示例
1. 客户端请求 → API端点
2. API端点 → 服务层
3. 服务层 → 数据访问层
4. 数据访问层 → 数据库
5. 响应按相反顺序返回

### 依赖关系
- API层依赖服务层
- 服务层依赖数据访问层和模型层
- 数据访问层依赖模型层
- 所有层都可能依赖基础设施层

### 设计原则
1. 单向依赖：上层依赖下层，避免循环依赖
2. 关注点分离：每层职责单一
3. 接口隔离：通过接口定义层间交互
4. 依赖注入：解耦各层实现 